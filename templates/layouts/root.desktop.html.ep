<!DOCTYPE html>
% no strict;no warnings;
% our $user=param 'user';
% our $is_admin=param 'admin';
% our $debug=param 'debug';
% our $leftpanel=$leftpanel // "Left panel!";
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" ><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en" ><!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title><%== "$title | $component" %></title>
	<link rel="stylesheet" href="<%= url_static_db 'foundation/css/foundation.css' %>">
	<link rel="stylesheet" href="<%= url_static_db 'font-awesome/css/font-awesome.css' %>">
	<script src="<%= url_static 'foundation/js/vendor/custom.modernizr.js' %>"></script>
	<style>
		.row {
			max-width: inherit;
		}
		.top-bar-section ul {
			background-color: #111;
		}
		.reveal-modal-bg {
			top: 45px;
		}
		@media only screen and (max-height: 22em) {
			.reveal-modal.open {
				top: 0px !important;
			}
		}
		@media only screen and (max-height: 15em) {
			.reveal-modal.open {
				top: -5em !important;
			}
		}
		.reveal-modal form {
			margin-bottom: 0px;
		}
		.reveal-modal .row.last .button {
			margin-bottom: 0px;
		}
		.top-bar a:hover:not(.inactive) {
			background-color: #555;
		}
		.top-bar .top-bar-section a:hover:not(.inactive) {
			background-color: #555;
		}
		a.inactive {
			cursor: default;
		}
		.no-js .no-js-open {
			display: block !important;
			visibility: visible; 
		}
		%= content_for 'style'
	</style>
	%= content_for 'head'
</head>
<body>
	<div id="all">
		<nav class="top-bar" id="navbar" data-options="scrolltop:false">
			<ul class="title-area">
				<li class="name" style="background-color: #090909"><h1><a class="inactive"><%= $title %></a></h1></li>
				<li class="toggle-topbar menu-icon"><a><span><%= l 'Menu' %></span></a></li>
			</ul>
			<section class="top-bar-section">
				<ul class="left">
					% {my $navItem=begin
							<li<%== ($_[0] eq $component ? ' class="active"' : '') %>>
								<a <%== $components->{$_[0]} ? 'href="'.url_for($components->{$_[0]}).'"' : '' %>>
									<%= $_[0] %>
								</a>
							</li>
						% end
						%= $navItem->($component);
					<li class="divider"></li>
						% foreach (sort keys %$components) {
							%= $navItem->($_) unless $_ eq $component;
						% }
					% }
				</ul>
				<ul class="right">
					% if ($user) {
						% if ($is_admin) {
							<li>
								<a href="<%= url_for '/admin' %>">
									<%= l 'Global settings' %>
								</a>
							</li>
						% }
						<li>
							<a href="<%= url_for '/profile' %>">
								<%= $user %>
							</a>
						</li>
					% } else {
						<li>
							<a href="<%= url_for '/register' %>">
								<%= l 'Create an Account' %>
							</a>
						</li>
					% }
					<li class="divider"></li>
					<li>
						% if ($user) {
							<a href="<%= url_for '/logout' %>">
								<%= l 'Log Out' %>
							</a>
						% } else {
							<a data-reveal-id="login-modal">
								<%= l 'Log In' %>
							</a>
						% }
					</li>
				</ul>
			</section>
		</nav>
		<div id="page">
			<%== content %>
		</div>
	</div>
	<div id="login-modal" class="reveal-modal medium">
		<h3>Log In</h3>
		<form method="post" action="/login">
			<div class="row">
				<div class="small-12 large-6 columns">
					<div class="row">
						<label>
							<%= l 'Username' %>
						</label>
						<input data-focus type="text" autocomplete="off" name="username" tabindex="1" />
					</div>
				</div>
				<div class="small-12 large-6 columns">
					<div class="row">
						<label>
							<%= l 'Password' %>
						</label>
						<div class="row collapse">
							<div class="small-12 large-8 columns">
								<input type="password" name="password" tabindex="2" />
							</div>
							<div class="show-for-small small-2 columns"></div>
							<div class="small-10 large-4 columns">
								% foreach ('button postfix right show-for-small','button postfix hide-for-small') {
								<a class="<%= $_ %>" href="/forgot" style="max-width: 10em;" tabindex="5">
									<%= l 'Forgot?' %>
								</a>
								% }
							</div>
						</div>
					</div>
				</div>
				<div class="small-12 large-9 push-3 columns left">
					<div class="row">
						<div class="large-6 small-12 columns">
						</div><div class="large-6 small-12 columns">
						</div>
					</div>
				</div>
				<div class="small-12 large-9 columns push-3 left">
					<div class="last row">
						<div class="row collapse">
							<div class="small-6 columns">
								<input type="submit" name="submit" class="success button expand right" tabindex="3" value="Login" />
							</div>
							<div class="small-6 columns">
								<a class="button expand" href="/register" tabindex="4">
									<%= l 'Register' %>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
		<a class="close-reveal-modal" tabindex="0"><i class="icon-remove"></i></a>
	</div>
	<div class="reveal-modal small no-js-open">
		<h1>This website works best with JavaScript enabled.</h1>
	</div>
	<script>
		if ('Modernizr' in window) {
			document.write('<script src=<%= url_static "foundation/js/vendor" %>/' +
				('__proto__' in {} ? 'zepto' : 'jquery') +
				'<%= !$debug && '.min' %>.js><\/script>');
		}else{ // static files failed to load
			var err=document.createElement('h1');
			err.innerText='<%= l 'Static file(s) failed to load, check your config (static_base=[_1])!', app->config('static_base') %>';
			document.body.appendChild(err);
		}
	</script>
	<script src="<%= url_static 'foundation/js/foundation.min.js'%>"></script>
	<script>
		$(document).foundation();
		$('.reveal-modal').foundation('reveal', {
			opened: function(){
				//var off=$(this).offset();
				//if (off.top+off.height > window.innerHeight) {
					//$(this).offset({top: (window.innerHeight - off.height)/2});
				//}
				$(this).find('input[data-focus]')[0].focus();
			}
		});
	</script>
</body>
</html>
